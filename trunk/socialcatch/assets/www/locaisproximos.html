<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
<title>Locais próximos</title>

<link rel="stylesheet" type="text/css"href="lib/resources/css/sencha-touch.css" />
<script type="text/javascript" src="lib/sencha-touch.js"></script>
<script type="text/javascript" charset="utf-8" src="phonegap.js"></script>


</head>

<body>

	<script type="text/javascript">
	
	//Localização!!
	

    // onSuccess Geolocation
    //
    function onSuccess(position) {
    	
    	alert('Latitude:'+position.coords.latitude+' Longitude:'+  position.coords.longitude);
      
    	Ext.util.JSONP.request({
			url : 'http://dl.dropbox.com/u/1301044/JSON/test.json',
			callbackkey: 'callback',
			callback: function(data){
				var nomelist = data.places;
				placesproximos.update(nomelist);
				
			}
		});
		
    }

    // onError Callback receives a PositionError object
    //
    function onError(error) {
        alert('code: '    + error.code    + '\n' +
              'message: ' + error.message + '\n');
    }

 // process the confirmation dialog result
    function onConfirm(button) {
        alert('Você selecionou:' + button);
        if(button==1){
        	window.open('mural.html');
        }
    }

    
		function clickListItem(id) {

			navigator.notification.confirm(
			        'Deseja efetuar check-in?',  // message
			        onConfirm,              // callback to invoke with index of button pressed
			        'Check-in',            // title
			        'Sim,Não'          // buttonLabels
			    );


		}

		Ext.setup({

					onReady : function() {
						
						//Registar o callback para quando tiver a localização...
						navigator.geolocation.getCurrentPosition(onSuccess, onError);
						
					
						
						placesproximos = new Ext.Component(
								{
									title : "Places Próximos",
									scroll : 'vertical',
									tpl : [
											'<tpl for="."  >',
											'<div id={id} onClick="clickListItem(id)" style="margin-top:3px">',
											'<img alt="" height="45" src="{tipo}" width="45" style="margin-right:10px; float:left  "  ><h2 style="font-weight: bold"> {nome}</h2><h3> {descricao}</h3>',
											'<hr>',
											'</div>',
											'</tpl>' ]

								});
						
						
						
						placesprocura = new Ext.Component(
								{
									layout: 'fit',
									style: 'padding-bottom:10px;',
									tpl : [
											'<tpl for="."  >',
											'<div id={id} onClick="clickListItem(id)" style="margin-top:3px">',
											'<img alt="" height="45" src="{tipo}" width="45" style="margin-right:10px; float:left  "  ><h2 style="font-weight: bold"> {nome}</h2><h3> {descricao}</h3>',
											'<hr>',
											'</div>',
											'</tpl>' ]

								});
					
					
						
						searchPanel = new Ext.Panel({
				            padding: 10,
				            layout: {
				                type: 'hbox',
				                align: 'stretch'
				            },
				            items: [{
				                flex: 3,
				                xtype: 'textfield',
				                style: 'margin-right: 10px;',
				                id: 'textquery'
				            },{
				                flex: 2,
				                xtype: 'button',
				                text: 'Procurar',
				                handler: function() {
				                	alert("Olá Mundo");
				                	
				                	Ext.util.JSONP.request({
				            			url : 'http://dl.dropbox.com/u/1301044/JSON/test.json',
				            			callbackkey: 'callback',
				            			callback: function(data){
				            				var nomelist = data.places;
				            				placesprocura.update(nomelist);
				            				
				            			}
				            		});
				                    //var query = Ext.getCmp("textquery").getValue();
				                    //Ext.Ajax.request({
				                        //url: 'index.php?act=search&q='+query,
				                        //url : 'http://dl.dropbox.com/u/1301044/JSON/test.json',
				                        //success: function(e) {
				                            //var obj = Ext.util.JSON.decode(e.responseText);
				                           // var msg = obj.results;
				                        //    var html = tpl.apply(msg);
				                         //  alert(msg);
				                       //    placesproximos.update(msg);
				                     //   }
				                   //});
				                }
				            }]
				        });
						
						
						
						var placespornome = new Ext.Panel({	
							title : "Procurar places",
				            items: [searchPanel, placesprocura],
				            scroll: 'vertical',
				            //style: 'background: #DDEEF6;',
				            fullscreen : true
				        });

						

						var buttonsSpecTop = [ {
							ui : 'back',
							text : 'Back'
						}, {
							xtype : 'spacer'
						}, {
							ui : 'forward',
							text : 'Forward'
						} ]

						var buttonsSpecBottom = [ {
							ui : 'normal',
							text : 'Normal'
						}, {
							ui : 'round',
							text : 'Round'
						}, {
							ui : 'action',
							text : 'Action'
						}, {
							ui : 'confirm',
							text : 'Confirm'
						} ]

						var tapHandler = function(btn, evt) {
							alert("Button '" + btn.text + "' tapped.");
						}

						var dockedItems = [ {
							xtype : 'toolbar',
							ui : 'dark',
							dock : 'bottom',
							items : buttonsSpecBottom,
							defaults : {
								handler : tapHandler
							}
						} ]

						var panel = new Ext.TabPanel({
							fullscreen : true,
							animation : 'slide',
							items : [ placesproximos, placespornome ],
							dockedItems : dockedItems

						});
						
						
					}
				});
			    
	</script>

</body>

</html>
